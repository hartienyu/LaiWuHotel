# 搜索功能重构 - 测试检查清单

## 测试场景

### ✅ 功能测试

#### 场景 1: 搜索结果存在
```
1. 打开搜索页面 (pages/search/search.js)
2. 输入已知酒店名称（如：假设数据库有 "如家酒店"）
3. 点击搜索或回车
4. 预期结果: 显示匹配的酒店列表
5. 验证项:
   - [ ] 搜索结果显示正确
   - [ ] 显示酒店名称、房间列表、评分
   - [ ] 房间卡片显示正确（房间名、价格、ID）
```

#### 场景 2: 搜索结果为空（触发兜底）
```
1. 输入不存在的酒店名称（如：xyzxyz）
2. 点击搜索
3. 预期结果: 显示所有酒店 + "兜底提示"
4. 验证项:
   - [ ] showFallbackHint 为 true
   - [ ] 显示兜底提示信息
   - [ ] 返回全部酒店数据
```

#### 场景 3: 清空搜索
```
1. 输入搜索词并搜索
2. 点击清空按钮
3. 预期结果: 搜索框清空，重新显示所有酒店
4. 验证项:
   - [ ] query 为空字符串
   - [ ] results 重置
   - [ ] showFallbackHint 重置为 false
```

#### 场景 4: 初始加载
```
1. 直接打开搜索页面（无 URL 参数）
2. 预期结果: 显示所有酒店列表
3. 验证项:
   - [ ] 页面加载时自动执行 doSearch()
   - [ ] 显示所有酒店
   - [ ] showFallbackHint 为 false
```

#### 场景 5: 通过 URL 参数搜索
```
1. 访问 /pages/search/search?q=酒店
2. 预期结果: 自动搜索 "酒店" 关键词
3. 验证项:
   - [ ] 搜索框显示 "酒店"
   - [ ] 自动执行搜索
   - [ ] 显示搜索结果
```

### 🏨 酒店相关测试

#### 场景 6: 打开预订弹窗
```
1. 在搜索结果中点击某间房间的"预订"按钮
2. 预期结果: 弹出预订对话框
3. 验证项:
   - [ ] 显示酒店名称和房间价格
   - [ ] 日期选择器可用
   - [ ] 日期范围限制在 [今天, 30天内]
```

#### 场景 7: 提交预订
```
1. 打开预订弹窗
2. 选择入住和离店日期
3. 点击"确认预订"
4. 预期结果: 提交预订请求
5. 验证项:
   - [ ] 日期验证正常
   - [ ] 调用 submitBooking() 云函数
   - [ ] 显示预订结果
```

#### 场景 8: 日期验证
```
1. 打开预订弹窗
2. 尝试选择无效日期组合（如离店 <= 入住）
3. 点击"确认预订"
4. 预期结果: 显示错误提示
5. 验证项:
   - [ ] 显示日期错误提示
   - [ ] 不提交请求
```

### 🗂️ 代码结构测试

#### 场景 9: 检查 searchHotels 服务
```
文件: services/booking/searchHotels.js

验证项:
  - [ ] 导出 searchHotels 函数
  - [ ] 导出 getHotelDetail 函数
  - [ ] 函数签名正确
  - [ ] 返回值格式正确
  - [ ] 错误处理完善
```

#### 场景 10: 检查页面导入
```
文件: pages/search/search.js

验证项:
  - [ ] 导入 submitBooking
  - [ ] 导入 searchHotels
  - [ ] 不包含对 goods 数据库的引用
  - [ ] 不包含对 fetchSearchHistory 的引用
```

#### 场景 11: 检查应用配置
```
文件: app.json

验证项:
  - [ ] pages/goods 中不包含 search/index
  - [ ] pages/goods 中不包含 search/fetchsearchresults
  - [ ] 其他配置正常
```

### ❌ 已清理验证

```
验证已删除的文件不存在:
  - [ ] pages/goods/search/ 目录已删除
  - [ ] services/good/fetchSearchHistory.js 已删除
  - [ ] services/good/fetchSearchResult.js 已删除
  - [ ] model/search.js 已删除
```

### 🔍 引用检查

```
bash 命令验证无残留引用:

# 搜索是否还有引用
grep -r "fetchSearchHistory" --include="*.js"
grep -r "fetchSearchResult" --include="*.js"
grep -r "pages/goods/search" --include="*.js" --include="*.json"

预期结果: 无返回（没有找到）
```

---

## 性能测试

| 操作 | 预期耗时 | 验证 |
|-----|---------|------|
| 搜索（有结果） | < 500ms | [ ] |
| 搜索（无结果）| < 500ms | [ ] |
| 打开弹窗 | < 200ms | [ ] |
| 提交预订 | < 3000ms | [ ] |

---

## 浏览器控制台检查

```javascript
// 在小程序开发者工具的控制台运行以下命令

// 1. 检查数据库查询
console.log('测试 hotels 集合查询...')
wx.cloud.database().collection('hotels').get().then(res => {
  console.log('✅ hotels 查询成功:', res.data.length, '条记录')
})

// 2. 检查搜索服务
import { searchHotels } from '../../services/booking/searchHotels'
searchHotels('酒店').then(result => {
  console.log('✅ searchHotels 执行成功:', result)
})

// 3. 检查是否有错误
console.log('观察控制台是否有错误信息')
```

---

## 已知问题追踪

| 问题 | 优先级 | 状态 | 备注 |
|-----|--------|------|------|
| 搜索结果排序 | 低 | 待优化 | 可按热度或评分排序 |
| 兜底逻辑 UI | 中 | ✅ 完成 | 已添加 showFallbackHint |
| 缓存机制 | 低 | 待实现 | 可缓存搜索结果 |

---

## 签字确认

测试人员: ________________  日期: ________________

全部测试通过: [ ] 是  [ ] 否

若有问题，请在下方记录:
```
_______________________________________________________
_______________________________________________________
_______________________________________________________
```

